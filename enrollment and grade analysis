libname PS_lib "C:\Users\jing\Desktop\634\STAT344";
FILENAME REFFILA "C:\Users\jing\Desktop\634\STAT344\STAT344_Grades_A";
FILENAME REFFILB  "C:\Users\jing\Desktop\634\STAT344\STAT344_Grades_B";
FILENAME REFIN  "C:\Users\jing\Desktop\634\STAT344\Instructors_Posted.xlsx";
/* Load data set A */
* Import Excel file;
PROC IMPORT DATAFILE=REFFILA
  DBMS=XLSX
  OUT=WORK.IMPORTA
  REPLACE;
  GETNAMES=YES;
RUN;
* Check against original Excel file before continuing;
proc print data=IMPORTA;
run;
* Created needed variables for setA;
data ps_lib.DSA;
  Set IMPORTA;
  st=find(progr,"-");
  School=substr(progr,1,st-1);
  stm=find(progr,"-",st+1);
  Major=substr(progr,stm+1);  
  Year=substr(stat344_taken,1,4);
  Section=substr(course_Sect,9);
  semno=substr(stat344_taken,5,2);
  select (semno);
    when ("10") Semester="Spring";
    when ("40") Semester="Summer";
    when ("70") Semester="Fall";
    otherwise semester="Error";
  end;
  Grade=STAT344_Grade;
  drop st stm semno Progr course_sect STAT344_Taken STAT344_grade;
run;
*check the data set A;
proc print data=ps_lib.DSA;
run;
* Check added variables before continuing;
/* Load data set B */
* Import Excel file;
PROC IMPORT DATAFILE=REFFILB
  DBMS=XLSX
  OUT=WORK.IMPORTB
  REPLACE;
  GETNAMES=YES;
RUN;
* Check against original Excel file before continuing;
proc print data=IMPORTB;
run;
* Check against original Excel file before continuing;
* Created needed variables;
data ps_lib.DSB;
  Set IMPORTB;
  Major="major_code"n;
  temp="term_code"n;
  Year=substr(temp,1,4);
  semno=substr(temp,5,2);
  select (semno);
    when ("10") Semester="Spring";
    when ("40") Semester="Summer";
    when ("70") Semester="Fall";
    otherwise Semester="Error";
  end;
  drop semno temp "term_code"n crn "major_code"n "major_name"n;
run;
* Check added variables before continuing;
proc print data=ps_lib.DSB;
run;
/* Load instructor data set*/
* Import Excel file;
PROC IMPORT DATAFILE=REFIN
  DBMS=XLSX
  OUT=WORK.IMPORTIN
  REPLACE;
  GETNAMES=YES;
RUN;
* Check against original Excel file before continuing;
proc print data=IMPORTIN;
run;
* Created needed variables;
data ps_lib.Inst;
  retain semo yearo;
  Set IMPORTIN;
  if missing(semester) then do;
    semester=semo;
    year=yearo;
    end;
  else do;
    semo=semester;
    yearo=year;
    end;
  drop semo yearo;
run;
* Check added variables before continuing;
proc print data=ps_lib.Inst;
run;
* Investigate school and major codes;
*try to get the School code which are associated with Major;
proc sort data=ps_lib.DSA out=schtemp nodupkey;
  by major school;
run;
proc print data=schtemp;
  var major school;
run;
proc sort data=ps_lib.DSB out=schtemp nodupkey;
  by major;
run;
proc print data=schtemp;
  var major;
run;
*Add the information of School to DATA Set b;
data ps_lib.DSB2;
set ps_lib.DSB;
if major="ACCT" or major="FNAN" or major="ISOM" then school="BU";
if major="ACS" or major="AIT" or major="BIOE" or major="CEIE" or major="CPE" or major="CS" or major="ELEN" or major="CYSE" or major="INFT" or major="ME"  or major="SYST" or major="DAEN" then school="VS";
if major="ASTR" or major="BIOL" or major="CDS" or major="EVSC" or major="CHEM" or major="GEOG" or major="MATH" or major="PHYS" then school="SC";
if major="ATT" or major="HDFS" then school="E1"; 
if major="AVT" or major="GAME" then school="AR"; 
if major="COMH" then school="HH";
if major="ECON" or major="ENGL" or major="CLS" or major="GLOA" or major="GVIP" or major="NEUR" then school="LA"; 
if major="GM" or major="UNDE" or major="HSGR" then school="UN"; 
if major="INDV" or major="INTS" then school="LA"; 
run;
*combinating data set A and data set B;
data STAT344;
set ps_lib.DSA ps_lib.DSB2 ;
run;
*unify the variable Year to be Charactical;
data STAT344;
set STAT344;
Year1=input(Year,$12.);
drop Year;
rename Year1=Year;
run;
data ps_lib.Inst;
set ps_lib.Inst;
Year1=input(Year,$12.);
drop Year;
rename Year1=Year;
run;
*combine the data with the sections information;
proc sort data=STAT344 OUT=STAT344;
by Year semester Section;
run;
proc sort data= ps_lib.Inst out= ps_lib.Inst;
by Year semester Section ;
run;
data STAT344;
Merge STAT344 ps_lib.Inst;
by Year semester Section;
run;
proc print data=STAT344;
run;
data STAT344;
set STAT344;
if Year=2014 and Semester="Spring" and section="001" then delete;
if Year=2014 and Semester="Spring" and section="002" then delete;
if Year=2014 and Semester="Summer" then delete;
run;
*to check if there has special grades;
proc freq data=STAT344;
table Grade;
run;
*delete the special grades----outliers;
data STAT344;
set STAT344;
if Grade="AU" or Grade="IN" or Grade="NR" or Grade="W" then delete;
run;
*Create the variable GPA;
data STAT344;
set STAT344;
if Grade="A+" then GPA=4;
if Grade="A" then GPA=4;
if Grade="A-" then GPA=3.67;
if Grade="B+" then GPA=3.33;
if Grade="B" then GPA=3;
if Grade="B-" then GPA=2.67;
if Grade="C+" then GPA=2.33;
if Grade="C" then GPA=2;
if Grade="C-" then GPA=1.67;
if Grade="D" then GPA=1;
if Grade="F" then GPA=0;
run;
proc print data=STAT344;
run;

*analysisï¼›
/* Descriptive Statistics */;
*a;
*get how enrollment changed over time;
proc freq data=STAT344;
table Year*Semester;
run;
proc means data=STAT344 n;
class Year Semester;
run;

*b;
*get the enrollment in each major year by year;
proc freq data=STAT344;
table Year*Major;
run;
proc means data=STAT344 n;
class Major;
run;
proc means data=STAT344 n;
class Year Major;
run;

*checking normality;
proc univariate data=STAT344 normal; 
		qqplot GPA /Normal(mu=est sigma=est color=red l=1);
		var GPA;
		run;
*c);
*comparing the GPA by Semester---using Kruskal Wallis test;
proc npar1way data=STAT344 wilcoxon;
class Semester;
var GPA;
run;
*comparing the GPA between Spring and Fall---using Kruskal Wallis test;
data Spring_Fall;
set STAT344;
if Semester="Fall" or Semester="Spring" then output;
run;
proc npar1way data=Spring_Fall wilcoxon;
class Semester;
var GPA;
run;
*comparing the GPA between Spring and Summer---using Kruskal Wallis test;
data Summer_Spring;
set STAT344;
if Semester="Fall" then delete;
run;
proc npar1way data=Summer_Spring wilcoxon;
class Semester;
var GPA;
run;
*comparing the GPA between Spring and Summer---using Kruskal Wallis test;
data Summer_Fall;
set STAT344;
if Semester="Spring" then delete;
run;
proc npar1way data=Summer_Fall wilcoxon;
class Semester;
var GPA;
run;

*d;
*comparing the GPA by Year---using Kruskal Wallis test;
proc npar1way data=STAT344 wilcoxon;
class Year;
var GPA;
run;
proc means data=STAT344 ;
class Year Semester section;
var GPA;
run;
*draw the box-plot of GPA by section;
data STAT(drop=data);
set STAT344;
date=cats(Year,Semester);
        _date=input(date,$12.);
        format _date $12.;
;
run;
data STAT;
set STAT;
Semester=date;
run;
ods graphics off;
proc boxplot data=STAT;
   plot GPA*Semester;
run;
*e;
*comparing the GPA by Major---using Kruskal Wallis test;
proc npar1way data=STAT344 wilcoxon;
class Major;
var GPA;
run;
proc means data=STAT344;
class Major;
var GPA;
run;
*draw the box-plot of GPA by Major;
proc sort data=STAT344;
by Major;
run;
proc boxplot data=STAT344;
   plot GPA*Major/MAXPANELS=100;;
run;

*f;
*comparing the GPA by School---using Kruskal Wallis test;
proc npar1way data=STAT344 wilcoxon  ;
class School;
var GPA;
run;
proc means data=STAT344 n mean;
class School;
var GPA;
run;
*draw the box-plot of GPA by School;
proc sort data=STAT344;
by School;
run;
proc boxplot data=STAT344;
   plot GPA*School/MAXPANELS=100;;
run;
*g;
*comparing the GPA by Instructor---using Kruskal Wallis test;
proc npar1way data=STAT344 wilcoxon;
class Instructor;
var GPA;
run;
proc means data=STAT344;
class Instructor;
var GPA;
run;
*draw the box-plot of GPA by Instructor;
proc sort data=STAT344;
by Instructor;
run;
proc boxplot data=STAT344;
   plot GPA*Instructor
;
run;
